-- -----------------------------------------------------
-- CREANDO TABLAS
-- -----------------------------------------------------
    CREATE TABLE MM_BANCOS (
    COD_ENTIDAD CHAR(5) NOT NULL,
    DES_BANCO VARCHAR(100) NOT NULL,
    DES_BAN_NCORTO VARCHAR(30) NOT NULL,
    DES_TIPO_ENTIDAD VARCHAR(50) NOT NULL,
    DES_TIPO_COMPETENCIA VARCHAR(40) NOT NULL,
    DES_TIPO_COMPETENCIA2 VARCHAR(40) NOT NULL,
    PRIMARY KEY (COD_ENTIDAD));

    CREATE TABLE MM_UBIGEO (
    COD_UBIGEO CHAR(6) NOT NULL,
    DES_DEPARTAMENTO VARCHAR(15) NOT NULL,
    DES_PROVINCIA VARCHAR(30) NOT NULL,
    DES_DISTRITO VARCHAR(50) NOT NULL,
    COD_CODIGO CHAR(6) NULL,
    DES_DISTRITO_DET VARCHAR(50) NOT NULL,
    FLG_ZONA CHAR(4) NOT NULL,
    DES_CENTROSNEGOCIO VARCHAR(20) NULL,
    DES_DISTRITO_AGG VARCHAR(30) NULL,
    FLG_CIUDAD CHAR(1) NOT NULL,
    PRIMARY KEY (COD_UBIGEO));

    CREATE TABLE MM_ONPE (
    COD_NUMDOC VARCHAR(8) NOT NULL,
    COD_DIGVER CHAR(1) NULL,
    DESC_GRPVOT VARCHAR(10) NOT NULL,
    COD_UBIGEO CHAR(6) NULL,
	APPATERNO VARCHAR(20) NOT NULL,
    APMATERNO VARCHAR(20) NOT NULL,
    NOMBRES VARCHAR(40) NULL,
    FECNAC DATE NOT NULL,
    FLG_SEXO CHAR(1) NULL,
        PRIMARY KEY (COD_NUMDOC));
    
    CREATE TABLE MM_CLIENTES (
    PERIODO NUMBER(6) NOT NULL,
    COD_SBS_CLI NUMBER NOT NULL,
    FEC_REPORTE DATE NOT NULL,
    TIP_DOC_TRI CHAR(1) NULL,
    RUC CHAR(11) NULL,
    TIP_DOC_IDE NUMBER NULL,
    COD_NUMDOC VARCHAR(8) NULL,
    TIP_PERSONA NUMBER NOT NULL,
    TIP_EMPRESA CHAR(1) NULL,
    CAN_EMPRESA NUMBER NOT NULL,
    DEU_CALIF0 NUMBER(5,2) NOT NULL,
    DEU_CALIF1 NUMBER(5,2) NOT NULL,
    DEU_CALIF2 NUMBER(5,2) NOT NULL,
    DEU_CALIF3 NUMBER(5,2) NOT NULL,
    DEU_CALIF4 NUMBER(5,2) NOT NULL,
    RAZ_SOC_O_AP VARCHAR(50) NOT NULL,
    APE_MATERNA VARCHAR(20) NOT NULL,
    APE_CASADA VARCHAR(20) NOT NULL,
    NOMBRE1 VARCHAR(20) NOT NULL,
    NOMBRE2 VARCHAR(20) NOT NULL,
    PRIMARY KEY (PERIODO, COD_SBS_CLI));
 
	CREATE TABLE MM_DEUDAS (
	IDDEUDA NUMBER NOT NULL,
    PERIODO NUMBER NOT NULL,
    COD_SBS_CLI NUMBER NOT NULL,
    COD_EMPRESA CHAR(5) NOT NULL,
    TIP_CREDITO CHAR(2) NOT NULL,
    COD_CUENTA CHAR(14) NOT NULL,
    CONDICION NUMBER NOT NULL,
    SALDO NUMBER(15,2) NOT NULL,
    CLASIFICACION NUMBER NOT NULL,
    PRIMARY KEY (IDDEUDA));

-- -----------------------------------------------------
-- CREANDO RELACIONES
-- -----------------------------------------------------

	create sequence CUSTOMER_ID minvalue 1 
	start with 1 cache 10;

    ALTER TABLE MM_CLIENTES DROP CONSTRAINT fk_CLIENTES_ONPE
    ALTER TABLE MM_CLIENTES
    ADD CONSTRAINT fk_CLIENTESONPE
    FOREIGN KEY (COD_NUMDOC)
    REFERENCES MM_ONPE(COD_NUMDOC);

    ALTER TABLE MM_ONPE DROP CONSTRAINT fk_ONPE_UBIGEO
    
    ALTER TABLE MM_ONPE
    ADD CONSTRAINT FK_ONPEUBIGEO
    FOREIGN KEY (COD_UBIGEO)
    REFERENCES MM_UBIGEO(COD_UBIGEO);

	ALTER TABLE MM_DEUDAS DROP CONSTRAINT FK_DEUDASCLIENTES;
    ALTER TABLE MM_DEUDAS DROP CONSTRAINT FK_DEUDASBANCOS;
    ALTER TABLE MM_DEUDAS
    ADD CONSTRAINT FK_DEUDASBANCOS
    FOREIGN KEY (COD_EMPRESA)
    REFERENCES MM_BANCOS(COD_ENTIDAD);
    
    ALTER TABLE MM_DEUDAS
    ADD CONSTRAINT FK_DEUDASCLIENTES
    FOREIGN KEY (PERIODO,COD_SBS_CLI)
    REFERENCES MM_CLIENTES(PERIODO,COD_SBS_CLI)